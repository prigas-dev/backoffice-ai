<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <title>Backoffice AI</title>

    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@19",
          "react/": "https://esm.sh/react@19/",
          "react-dom/": "https://esm.sh/react-dom@19/"
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col">
          <button id="reload-button" class="btn btn-primary">Recarregar</button>
        </div>
        <div id="root"></div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script type="module">
      import { createRoot } from "react-dom/client";
      import { jsx as h, jsxs as hs } from "react/jsx-runtime";
      import { useState } from "react";

      function Banana() {
        const [count, setCount] = useState(0);
        return hs("div", {
          children: [
            h("button", { onClick: () => setCount(count + 1), children: "+" }),
            count,
          ],
        });
      }

      const root = createRoot(document.getElementById("root"));

      let isLoading = false;
      const reloadButton = document.getElementById("reload-button");
      reloadButton.addEventListener("click", async function () {
        if (isLoading) {
          return;
        }
        isLoading = true;
        reloadButton.disabled = true;
        try {
          const response = await fetch("/generate-component", {
            method: "post",
          });
          if (!response.ok) {
            const message = await response.text();
            throw new Error(`[${response.status}] ${message}`);
          }
          await updateReactComponent();
        } catch (error) {
          alert(error.message);
          console.error(error);
        } finally {
          isLoading = false;
          reloadButton.disabled = false;
        }
      });

      async function updateReactComponent() {
        const mod = await import(`./public/component.mjs?t=${Date.now()}`);
        root.render(h(mod.Component, {}));
      }
    </script>
  </body>
</html>
